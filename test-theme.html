<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Theme Toggle</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        /* === MODO CLARO (LIGHT THEME) === */
        :root {
            --md-sys-color-primary: #386A20;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #B7F399;
            --md-sys-color-on-primary-container: #082100;
            --md-sys-color-secondary: #55624C;
            --md-sys-color-on-secondary: #FFFFFF;
            --md-sys-color-secondary-container: #D9E7CA;
            --md-sys-color-on-secondary-container: #131F0D;
            --md-sys-color-error: #BA1A1A;
            --md-sys-color-on-error: #FFFFFF;
            --md-sys-color-background: #FCFDF7;
            --md-sys-color-on-background: #1A1C18;
            --md-sys-color-surface: #FCFDF7;
            --md-sys-color-on-surface: #1A1C18;
            --md-sys-color-surface-variant: #E0E4D7;
            --md-sys-color-on-surface-variant: #43483E;
            --md-sys-color-outline: #74796D;
            --md-sys-color-surface-container-high: #E9E9E2;
            --md-sys-color-surface-container-low: #F4F4ED;
        }

        /* === MODO OSCURO (DARK THEME) === */
        @media (prefers-color-scheme: dark) {
            :root {
                --md-sys-color-primary: #9CDA7F;
                --md-sys-color-on-primary: #082100;
                --md-sys-color-primary-container: #1F3314;
                --md-sys-color-on-primary-container: #B7F399;
                --md-sys-color-secondary: #BCCAB0;
                --md-sys-color-on-secondary: #263420;
                --md-sys-color-secondary-container: #3A4A2F;
                --md-sys-color-on-secondary-container: #D9E7CA;
                --md-sys-color-error: #FFB4AB;
                --md-sys-color-on-error: #690005;
                --md-sys-color-background: #1A1C18;
                --md-sys-color-on-background: #E0E4D7;
                --md-sys-color-surface: #2B2D28;
                --md-sys-color-on-surface: #E0E4D7;
                --md-sys-color-surface-variant: #43483E;
                --md-sys-color-on-surface-variant: #C4C8BB;
                --md-sys-color-outline: #8E9388;
                --md-sys-color-surface-container-high: #2F312C;
                --md-sys-color-surface-container-low: #1F211C;
            }
        }

        /* === CLASE PARA MODO OSCURO MANUAL === */
        .dark-theme {
            --md-sys-color-primary: #9CDA7F;
            --md-sys-color-on-primary: #082100;
            --md-sys-color-primary-container: #1F3314;
            --md-sys-color-on-primary-container: #B7F399;
            --md-sys-color-secondary: #BCCAB0;
            --md-sys-color-on-secondary: #263420;
            --md-sys-color-secondary-container: #3A4A2F;
            --md-sys-color-on-secondary-container: #D9E7CA;
            --md-sys-color-error: #FFB4AB;
            --md-sys-color-on-error: #690005;
            --md-sys-color-background: #1A1C18;
            --md-sys-color-on-background: #E0E4D7;
            --md-sys-color-surface: #2B2D28;
            --md-sys-color-on-surface: #E0E4D7;
            --md-sys-color-surface-variant: #43483E;
            --md-sys-color-on-surface-variant: #C4C8BB;
            --md-sys-color-outline: #8E9388;
            --md-sys-color-surface-container-high: #2F312C;
            --md-sys-color-surface-container-low: #1F211C;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--md-sys-color-background);
            color: var(--md-sys-color-on-background);
            margin: 0;
            padding: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .test-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--md-sys-color-surface);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .theme-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .theme-btn:hover {
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .color-card {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
        }

        .primary { background-color: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); }
        .primary-container { background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); }
        .secondary { background-color: var(--md-sys-color-secondary); color: var(--md-sys-color-on-secondary); }
        .secondary-container { background-color: var(--md-sys-color-secondary-container); color: var(--md-sys-color-on-secondary-container); }
        .surface { background-color: var(--md-sys-color-surface); color: var(--md-sys-color-on-surface); }
        .surface-container { background-color: var(--md-sys-color-surface-container-low); color: var(--md-sys-color-on-surface); }
    </style>
    
    <!-- Script para aplicar tema inmediatamente -->
    <script>
        (function() {
            const theme = localStorage.getItem('theme') || 'light';
            console.log('Script inline test: tema detectado:', theme);
            if (theme === 'dark') {
                document.documentElement.classList.add('dark-theme');
                console.log('Script inline test: clase dark-theme aplicada');
            }
        })();
    </script>
</head>
<body>
    <div class="test-container">
        <h1>Test de Cambio de Tema - Corral X</h1>
        
        <div class="theme-toggle">
            <button id="themeToggleBtn" class="theme-btn">
                <span class="material-symbols-outlined theme-icon">dark_mode</span>
                <span>Cambiar Tema</span>
            </button>
            <span id="currentTheme">Modo Claro</span>
        </div>

        <p>Este es un test para verificar que el cambio de tema funciona correctamente.</p>

        <div class="color-palette">
            <div class="color-card primary">Primary</div>
            <div class="color-card primary-container">Primary Container</div>
            <div class="color-card secondary">Secondary</div>
            <div class="color-card secondary-container">Secondary Container</div>
            <div class="color-card surface">Surface</div>
            <div class="color-card surface-container">Surface Container</div>
        </div>
    </div>

    <script>
        // Variables de tema
        let currentTheme = localStorage.getItem('theme') || 'light';
        let isDarkMode = currentTheme === 'dark';

        // Funciones de tema
        function initializeTheme() {
            applyTheme(currentTheme);
            
            if (!localStorage.getItem('theme')) {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                currentTheme = prefersDark ? 'dark' : 'light';
                isDarkMode = prefersDark;
                applyTheme(currentTheme);
            }
        }

        function applyTheme(theme) {
            const html = document.documentElement;
            
            console.log('Aplicando tema:', theme);
            console.log('Clase actual:', html.className);
            
            if (theme === 'dark') {
                html.classList.add('dark-theme');
                currentTheme = 'dark';
                isDarkMode = true;
            } else {
                html.classList.remove('dark-theme');
                currentTheme = 'light';
                isDarkMode = false;
            }
            
            console.log('Clase después:', html.className);
            updateThemeUI();
            localStorage.setItem('theme', theme);
            console.log('Tema guardado:', theme);
        }

        function updateThemeUI() {
            const themeIcons = document.querySelectorAll('.theme-icon');
            const currentThemeSpan = document.getElementById('currentTheme');
            
            themeIcons.forEach(icon => {
                icon.textContent = currentTheme === 'dark' ? 'light_mode' : 'dark_mode';
            });
            
            if (currentThemeSpan) {
                currentThemeSpan.textContent = currentTheme === 'dark' ? 'Modo Oscuro' : 'Modo Claro';
            }
        }

        function toggleTheme() {
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            console.log('Cambiando de', currentTheme, 'a', newTheme);
            applyTheme(newTheme);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded test: inicializando...');
            initializeTheme();
            
            const themeBtn = document.getElementById('themeToggleBtn');
            console.log('Botón encontrado:', themeBtn);
            
            if (themeBtn) {
                themeBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('🖱️ Click en botón de tema detectado');
                    toggleTheme();
                });
                console.log('✅ Event listener conectado');
            } else {
                console.log('❌ No se encontró el botón');
            }
        });

        // Escuchar cambios en las preferencias del sistema
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (!localStorage.getItem('theme')) {
                const newTheme = e.matches ? 'dark' : 'light';
                applyTheme(newTheme);
            }
        });
    </script>
</body>
</html>
